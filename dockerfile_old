# Base image with CUDA and Python support
FROM nvidia/cuda:12.2.0-runtime-ubuntu22.04

# Avoid interactive prompts during install
ENV DEBIAN_FRONTEND=noninteractive

# Install system packages: Python, PostgreSQL, etc.
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
    python3 python3-pip python3-venv \
    postgresql postgresql-contrib \
    curl ca-certificates gnupg software-properties-common \
    && rm -rf /var/lib/apt/lists/*

# Set Python aliases
RUN ln -s /usr/bin/python3 /usr/bin/python && \
    ln -s /usr/bin/pip3 /usr/bin/pip

# Add a non-root user (optional)
RUN useradd -ms /bin/bash appuser
USER appuser
WORKDIR /home/appuser/app

# Copy local project files if needed
# COPY . .

# Expose PostgreSQL port
EXPOSE 5432

# Default command: start Postgres
CMD ["/usr/lib/postgresql/14/bin/postgres", "-D", "/var/lib/postgresql/data"]